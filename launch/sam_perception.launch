<launch>
  <arg name="video_device" default="false" /> <!--Use video device online-->
  <arg name="perspective" default="dockingstation" /> <!--None, camera or dockingstation-->
  <arg name="publish_path" default="true" /> <!--if true, perspective has to be given-->
  <arg name="sim" default="false" /> <!-- When running simulation, some topic needs to be remapped-->
  <arg name="hz" default="15"/>
  <arg name="pose_feedback" default="true"/>
  <arg name="cv_show" default="false"/>
  <arg name="rviz" default="false"/>
  <arg name="sam" default="true"/>

  <!--Some parameters for the perception node-->
  <arg name="feature_model_yaml" default="real_visual_docking_station.yaml" />
  <arg name="hats_mode" default="valley" /> <!--peak, valley or simple-->

  <node name="perception_node" pkg="lolo_perception" type="perception_node.py" output="screen" >
    <param name="feature_model_yaml" value="$(arg feature_model_yaml)"/>
    <param name="hz" value="$(arg hz)"/>
    <param name="cv_show" value="$(arg cv_show)"/>
    <param name="publish_cam_pose" value="$(eval arg('perspective') == 'dockingstation')"/>
    <param name="hats_mode" value="$(arg hats_mode)"/>
    <param name="pose_feedback" value="$(arg pose_feedback)"/>

    <param name="right_image_topic" value="/camera1/video_source/raw"/>
    <param name="left_image_topic" value="/camera1/video_source/raw"/>
    <remap from="/lolo_camera/camera_info" to="/sam/perception/camera_right/camera_info"/>

    <!--<remap from="/lolo_camera/image_rect_color"-->
        <!--to="/sam/perception/csi_cam_2/throttled/image_rect_color" if="$(eval arg('sam') == true)"/>-->
    <!--<remap from="/lolo_camera/image_rect_color"-->
        <!--to="/camera1/video_source/raw" if="$(eval arg('sam') == true)"/>-->
    <!--<remap from="/lolo_camera/camera_info"-->
        <!--to="/sam/perception/csi_cam_1/camera/camera_info" if="$(eval arg('sam') == true)"/>-->

    <!--<remap from="/lolo_camera/image_rect_color"-->
        <!--to="/sam/perception/csi_cam_2/camera/image_rect_color" if="$(eval arg('sam') == true)"/>-->
    <!--<remap from="/lolo_camera/camera_info"-->
        <!--to="/sam/perception/csi_cam_2/camera/camera_info" if="$(eval arg('sam') == true)"/>-->

  </node>

  <node pkg="lolo_perception" type="path_publisher_node.py" name="path_publisher_node" if="$(eval arg('publish_path') == true)">
    <remap from="/pose_topic" to="/docking_station_pose" if="$(eval arg('perspective') == 'camera')"/>
    <remap from="/pose_topic" to="/lolo_camera/estimated_pose" if="$(eval arg('perspective') == 'dockingstation')"/>
  </node>

  <!--<node pkg="tf" type="static_transform_publisher" name="docking_station_link" args="0 0 1 1.571 0 -1.571 map docking_station_link 100" if="$(eval arg('perspective') == 'dockingstation')"/>-->
  <!--<node pkg="tf" type="static_transform_publisher" name="lolo_camera_link" args="0 0 1 -1.571 0 -1.571 map lolo_camera_link 100" if="$(eval arg('perspective') == 'camera')"/>-->

  <node type="rviz" name="rviz" pkg="rviz" args="-d $(find lolo_perception)/rviz/lolo.rviz" if="$(arg rviz)"/>

</launch>
